<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8">
    <script src="./static/blockly_compressed.js"></script>
    <script src="./static/blocks_compressed.js"></script>
    <script src="./static/javascript_compressed.js"></script>
    <script src="./static/msg/js/zh-hans.js"></script>
</head>
<body>
<!-- <div ondragover="allowDrop(event)" id="div1" ondrop="drop(event)">
<img src="./eg_dragdrop_w3school.gif" draggable="true" ondragstart="drag(event)" id="drag1"/>
</div>

<div id="div2" ondrop="drop(event)" ondragover="allowDrop(event)">

</div> -->
<div id="blocklyDiv" style="height: 480px; width: 600px;"></div>
<div id="codeBox" style="height: 80px; width: 600px;border: 1px #eeeeee solid;margin: 10px 0"></div>
<button onclick="toShowJs()">toShowJs</button>
<button onclick="toRunJs()">toRunJs</button>
<xml id="toolbox" style="display: none">
    <block type="hello"></block>
</xml>
<script>
    Blockly.Blocks['hello'] = {
        init: function() {
            this.appendDummyInput()
            .appendField("输出")
            .appendField(new Blockly.FieldTextInput("hello world"), "say_content");
            this.setInputsInline(true);
            this.setPreviousStatement(true, null);
            this.setNextStatement(true, null);
            this.setColour(230);
            this.setTooltip("");
            this.setHelpUrl("");
        }
    };
    Blockly.JavaScript['hello'] = function (block) {
        var text_say_content = block.getFieldValue('say_content');
        // TODO: Assemble JavaScript into code variable.
        var code = `console.log('${text_say_content}')`;
        return code;
    };
    this.demoWorkspace = Blockly.inject('blocklyDiv',  {toolbox: document.getElementById('toolbox')});
    var toShowJs = function () {
        this.latestCode = Blockly.JavaScript.workspaceToCode(this.demoWorkspace);
        document.getElementById('codeBox').innerHTML = this.latestCode
    };
    var toRunJs = function () {
        try {
            eval(this.latestCode)
        }
        catch (e) {
            console.log(e)
        }
    }
    </script>
</body>
</html>
